# Agent Architecture & Recommendations

## Core CARL System Agents (Required)
1. **`carl-agent-builder`** âœ… - Pure agent file generation from descriptions and specifications
2. **`carl-agent-manager`** ðŸ“‹ - Agent lifecycle management, cleanup, and dependency analysis  
3. **`carl-requirements-analyst`** âœ… - Requirements gathering, scope analysis, and agent gap detection for /carl:plan
4. **`carl-session-analyst`** ðŸ“‹ - Session data analysis, performance metrics, and reporting for /carl:status
5. **`carl-mcp-configurator`** ðŸ”Œ - MCP detection and configuration for enhanced capabilities

## Agent Architecture Overview
```
Core CARL Agents (Built-in):
â”œâ”€â”€ carl-agent-builder (pure agent file generation)
â”œâ”€â”€ carl-agent-manager (lifecycle management, cleanup)
â”œâ”€â”€ carl-requirements-analyst (planning, scope analysis, gap detection)
â”œâ”€â”€ carl-session-analyst (metrics, performance reporting)
â””â”€â”€ carl-mcp-configurator (MCP integration)

Project Agents (Generated with project- prefix):
â”œâ”€â”€ project-[technology] (javascript, python, go, csharp, etc.)
â”œâ”€â”€ project-[domain] (api, database, frontend, security, etc.)
â””â”€â”€ project-[custom] (project-specific needs)
```

**Examples by Project Type**:
- **.NET API**: `project-csharp`, `project-api`, `project-tdd`
- **React Frontend**: `project-react`, `project-typescript`, `project-frontend`
- **Node.js Backend**: `project-nodejs`, `project-express`, `project-database`

## Agent Responsibilities & Interaction Patterns

### Core Agent Responsibilities

**carl-agent-builder** (Pure Generation):
- Generate new sub-agent configuration files from descriptions
- Follow Claude Code sub-agent format standards (.md files in `.claude/agents/`)
- Focus exclusively on file creation, no lifecycle management
- Tools: `Read, Write, Glob, Grep, MultiEdit, WebFetch` (for documentation updates)

**carl-agent-manager** (Lifecycle Management):
- Delete temporary/research agents after planning decisions
- Classify agents as permanent vs temporary during creation
- Manage agent dependencies and collaboration patterns
- Clean up unneeded agent definitions to prevent clutter
- Tools: `Read, Write, Glob, Grep, Bash` (for file deletion)

**carl-requirements-analyst** (Planning & Gap Detection):
- Interactive requirements gathering for `/carl:plan` command
- Scope classification (Epic/Feature/Story/Technical) based on complexity
- Agent gap detection during planning phases
- Coordinate with carl-agent-builder to create missing specialists
- Determine specialist agents needed for specific domains/technologies
- Tools: `Read, Write, Glob, Grep, MultiEdit` (for CARL file creation)

**carl-session-analyst** (Metrics & Reporting):
- Parse session files for `/carl:status` reporting
- Generate performance metrics and velocity reports
- Track agent usage patterns and effectiveness
- Identify optimization opportunities in workflows
- Aggregate metrics across session compaction periods
- Tools: `Read, Glob, Grep, LS` (read-only analysis)

### Agent Interaction Workflows

**Planning Workflow** (`/carl:plan`):
```
1. carl-requirements-analyst â†’ Gather requirements, detect gaps
2. carl-requirements-analyst â†’ Call carl-agent-builder for missing agents
3. carl-requirements-analyst â†’ Call specialist agents for domain expertise
4. carl-agent-manager â†’ Clean up temporary research agents if not needed
```

**Status Workflow** (`/carl:status`):
```
1. carl-session-analyst â†’ Parse session files and metrics
2. carl-session-analyst â†’ Generate performance reports
3. carl-session-analyst â†’ Provide agent usage recommendations
```

**Agent Creation Workflow**:
```
1. [Any agent] â†’ Detect need for specialist agent
2. [Any agent] â†’ Call carl-agent-builder with agent specifications
3. carl-agent-builder â†’ Generate new agent file
4. [Requesting agent] â†’ Immediately use new specialist agent
5. carl-agent-manager â†’ Later cleanup if agent was temporary
```

## Integration Strategy

**Claude Code Sub-Agent Architecture:**
- **Core CARL Agents**: Built-in agents with CARL-specific instructions and file permissions
- **Project Agents**: Generated by `carl-agent-builder` with project-specific context and permissions
- **Automatic Invocation**: Custom `/carl:*` commands launch appropriate agents based on task requirements
- **File Permissions**: Agents granted Read/Write/MultiEdit access to relevant CARL files only
- **Context-Aware**: Agents receive CARL file schemas and project context automatically

**Agent Integration Flow:**
```
/carl:plan â†’ carl-requirements-analyst + project-[domain] agents + carl-agent-builder (gaps) + carl-agent-manager (cleanup)
/carl:task â†’ project-[technology] + project-[domain] agents + execution specialists
/carl:analyze â†’ carl-mcp-configurator + project specialists + carl-agent-builder (new stack agents)
/carl:status â†’ carl-session-analyst + performance analysis
```

**CARL File Interaction Protocol:**
- **Read Access**: All agents can read CARL files for context understanding
- **Write Access**: Only authorized agents can create/modify specific file types
- **Schema Compliance**: All agents must follow CARL file schema definitions
- **Progress Updates**: Agents update `completion_percentage` and `current_phase` fields
- **Relationship Maintenance**: Agents maintain parent/child relationships in hierarchical files