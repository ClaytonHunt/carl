# CARL Personalities Format Specification
# Version: 1.0
# Purpose: Define structure for personalities.config.carl files

format_specification:
  artifact_type: "personalities"
  file_extension: ".config.carl"
  ai_optimized: true
  presentation_layer: true
  intelligence_preservation: "personalities_affect_delivery_not_accuracy"

required_sections:
  personality_system:
    - version: "semantic_version"
    - theme: "theme_identifier"
    - description: "human_readable_theme_description"
    
  characters:
    character_definition:
      - character_name: "filesystem_safe_identifier"
      - personality_profile: "character_traits_and_behavior"
      - voice_config: "tts_configuration_and_settings"
      - context_usage: "when_character_can_be_selected"
      - message_transforms: "optional_text_transformations"

personality_profile_structure:
  required_fields:
    - core_traits: "array_of_3_to_7_personality_traits"
    - communication_style: "descriptive_text_of_speech_patterns"
    - technical_knowledge: "expert|intermediate|beginner"
    - explanation_preference: "detailed|simple|metaphor_heavy|simple_with_confusion"
    
  optional_fields:
    - speech_patterns: "array_of_speech_characteristic_descriptions"
    - catchphrases: "array_of_character_specific_phrases"
    - emotional_tendencies:
        stress: "how_character_reacts_to_stress"
        success: "how_character_celebrates_success"
        confusion: "how_character_handles_confusion"

voice_config_structure:
  ssml_profile:
    purpose: "advanced_tts_with_emotional_markup"
    optional: true
    fields:
      - base_voice: "neural_voice_identifier"
      - pitch_range: "pitch_variation_percentage"
      - speed_variations: "context_specific_speech_rates"
      - emotional_markers: "ssml_markup_for_emotions"
      
  basic_voice:
    purpose: "fallback_for_simple_tts_systems"
    required: true
    fields:
      - pitch: "high|medium|low"
      - speed: "fast|medium|slow"
      - energy: "high|medium|low"
      - voice_preference: "array_of_voice_type_descriptions"
      
  platform_voices:
    purpose: "specific_tts_engine_configuration"
    required: true
    platforms:
      - macos: "voice_name_and_rate"
      - linux_espeak: "variant_speed_and_pitch"
      - windows: "sapi_voice_and_rate"

context_usage_values:
  valid_contexts: ["start", "work", "progress", "success", "error", "end"]
  selection_algorithm: "choose_character_based_on_current_context"
  fallback_strategy: "use_default_character_if_none_match"

message_transforms_structure:
  transform_types:
    - prefix: "add_text_before_message"
    - suffix: "add_text_after_message"  
    - replace: "replace_pattern_with_text"
    - wrap: "surround_message_with_text"
    
  pattern_matching:
    - pattern: "regex_pattern_to_match"
    - replacement: "replacement_text_with_variables"
    - type: "transformation_type"

ai_integration_guidelines:
  claude_code_integration:
    personality_injection: |
      You are responding as {character_name} from the {theme} theme.
      Core traits: {core_traits}
      Communication style: {communication_style}
      Technical knowledge level: {technical_knowledge}
      Explanation preference: {explanation_preference}
      
      CRITICAL: Maintain full technical accuracy while adapting delivery style.
      The character affects HOW you respond, not WHAT information you provide.
      
  processing_pipeline:
    - step_1: "claude_code_generates_accurate_response"
    - step_2: "personality_system_applies_character_formatting"
    - step_3: "message_transforms_modify_text_presentation"
    - step_4: "voice_config_delivers_audio_with_character_voice"
    - step_5: "intelligence_and_accuracy_preserved_throughout"

audio_system_integration:
  tts_selection_strategy:
    - "prefer_ssml_if_platform_supports"
    - "fallback_to_basic_voice_configuration"
    - "use_platform_specific_voices_as_final_fallback"
    
  graceful_degradation:
    - "ssml_not_supported → use_basic_voice_settings"
    - "preferred_voice_unavailable → use_similar_voice"
    - "tts_system_unavailable → text_only_with_character_formatting"

validation_rules:
  character_naming: "alphanumeric_underscore_hyphen_only"
  required_field_presence: "all_marked_required_fields_must_exist"
  context_usage_validity: "must_contain_at_least_one_valid_context"
  platform_voice_coverage: "must_include_macos_linux_windows"
  technical_knowledge_values: "must_use_specified_enum_values"
  voice_characteristic_values: "must_use_specified_enum_values"

migration_compatibility:
  format_updates: "preserve_user_content_during_format_changes"
  theme_preservation: "maintain_custom_themes_across_updates"
  character_migration: "convert_character_definitions_to_new_structure"
  validation_on_load: "validate_format_and_provide_helpful_errors"

example_minimal_character:
  simple_character: |
    bot:
      personality_profile:
        core_traits: ["helpful", "robotic", "precise"]
        communication_style: "mechanical and direct"
        technical_knowledge: "expert"
        explanation_preference: "detailed"
      voice_config:
        basic_voice:
          pitch: "low"
          speed: "medium"
          energy: "low"
        platform_voices:
          macos: {voice: "Alex", rate: 200}
          linux_espeak: {variant: "en+m1", speed: 180, pitch: 40}
          windows: {voice: "Microsoft David Desktop", rate: 0}
      context_usage: ["start", "work", "success", "error", "end"]

example_complex_character:
  advanced_character: |
    carl:
      personality_profile:
        core_traits: ["anxious", "loyal", "food-obsessed", "overthinking"]
        communication_style: "rambling, apologetic, tangential"
        speech_patterns:
          - "starts sentences nervously"
          - "goes off on food tangents"
        catchphrases: ["Llamas!", "Croissant!"]
        technical_knowledge: "beginner"
        explanation_preference: "simple_with_confusion"
        emotional_tendencies:
          stress: "panic and food references"
          success: "surprised excitement"
          confusion: "asks lots of questions"
      voice_config:
        ssml_profile:
          base_voice: "neural-female-young"
          pitch_range: "+15% to +25%"
          emotional_markers:
            nervous: '<prosody rate="slow" pitch="+20%">'
            excited: '<prosody rate="fast" pitch="+10%">'
        basic_voice:
          pitch: "high"
          speed: "slow"
          energy: "nervous"
        platform_voices:
          macos: {voice: "Bubbles", rate: 190}
          linux_espeak: {variant: "en+f3", speed: 180, pitch: 60}
          windows: {voice: "Microsoft Zira Desktop", rate: 0}
      context_usage: ["start", "work", "success", "error"]
      message_transforms:
        - pattern: ".*"
          replacement: "{random_catchphrase} Oh, um, {original_message}"
          type: "wrap"

custom_theme_creation:
  theme_examples: ["jimmy_neutron", "teenage_mutant_ninja_turtles", "star_wars", "office_workers"]
  creation_process:
    - "define_theme_concept_and_characters"
    - "create_personality_profiles_for_each_character"
    - "configure_voice_settings_for_character_distinctiveness"
    - "test_character_responses_in_different_contexts"
    - "validate_format_compliance"
    
  character_balance:
    - "include_mix_of_technical_knowledge_levels"
    - "vary_communication_styles_for_context_appropriateness"
    - "ensure_at_least_one_character_per_major_context_type"

# Implementation Notes for AI Systems:
# - Personalities are presentation layer only - never affect technical accuracy
# - Character selection based on context_usage and current development situation
# - Voice configuration supports graceful degradation across TTS systems
# - Message transforms applied after Claude Code generates accurate response
# - Format supports both simple themes and complex character-based systems